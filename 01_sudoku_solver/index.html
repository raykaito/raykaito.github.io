<!DOCTYPE HTML>

<html>

<head>
	<title>Sudoku Solver</title>
	<link rel="stylesheet" href="../rayStyle.css" type="text/css">
	<link rel="icon" type="image/png" href="../icon.png">
	<meta name="viewport" content="width=720, initial-scale=1"/>
</head>


<body onload="updateTable();" onKeyPress="main(window.event.keyCode);" id="Body">
	<table id="Table" border="0" align="center" width="700" opacity="0">
	
		<tr>
			<td colspan="2" align="center">
				<B> <Font size="6"><titleda>
					Sudoku Solver
				</Font></titleda></B>
				<hr>
			</td>
		</tr>
		<tr>
			<td align="center">	
			<beautiful>
				<table id="Puzzle" border="8" cellspacing="0" cellpadding="1" width="700" align="center" bgcolor="white">
				<form name="field">
				
					<tr height ="75" align="center">
						<td><input type="text"  id=0 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=1 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=2 value="0" size="10" style="text-align: center;border: none;"></td>
						<td style="border-left:solid 5px;"><input type="text"  id=3 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=4 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=5 value="0" size="10" style="text-align: center;border: none;"></td>
						<td style="border-left:solid 5px;"><input type="text"  id=6 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=7 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=8 value="0" size="10" style="text-align: center;border: none;"></td>
					</tr>			
					<tr height ="75" align="center">
						<td><input type="text"  id=9 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=10 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=11 value="0" size="10" style="text-align: center;border: none;"></td>
						<td style="border-left:solid 5px;"><input type="text"  id=12 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=13 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=14 value="0" size="10" style="text-align: center;border: none;"></td>
						<td style="border-left:solid 5px;"><input type="text"  id=15 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=16 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=17 value="0" size="10" style="text-align: center;border: none;"></td>
					</tr>				
					<tr height ="75" align="center">
						<td style="border-bottom:solid 5px;"><input type="text"  id=18 value="0" size="10" style="text-align: center;border: none;"></td>
						<td style="border-bottom:solid 5px;"><input type="text"  id=19 value="0" size="10" style="text-align: center;border: none;"></td>
						<td style="border-bottom:solid 5px;"><input type="text"  id=20 value="0" size="10" style="text-align: center;border: none;"></td>
						<td style="border-bottom:solid 5px;border-left:solid 5px;"><input type="text"  id=21 value="0" size="10" style="text-align: center;border: none;"></td>
						<td style="border-bottom:solid 5px;"><input type="text"  id=22 value="0" size="10" style="text-align: center;border: none;"></td>
						<td style="border-bottom:solid 5px;"><input type="text"  id=23 value="0" size="10" style="text-align: center;border: none;"></td>
						<td style="border-bottom:solid 5px;border-left:solid 5px;"><input type="text"  id=24 value="0" size="10" style="text-align: center;border: none;"></td>
						<td style="border-bottom:solid 5px;"><input type="text"  id=25 value="0" size="10" style="text-align: center;border: none;"></td>
						<td style="border-bottom:solid 5px;"><input type="text"  id=26 value="0" size="10" style="text-align: center;border: none;"></td>
					</tr>				
					<tr height ="75" align="center">
						<td><input type="text"  id=27 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=28 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=29 value="0" size="10" style="text-align: center;border: none;"></td>
						<td style="border-left:solid 5px;"><input type="text"  id=30 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=31 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=32 value="0" size="10" style="text-align: center;border: none;"></td>
						<td style="border-left:solid 5px;"><input type="text"  id=33 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=34 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=35 value="0" size="10" style="text-align: center;border: none;"></td>
					</tr>				
					<tr height ="75" align="center">
						<td><input type="text"  id=36 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=37 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=38 value="0" size="10" style="text-align: center;border: none;"></td>
						<td style="border-left:solid 5px;"><input type="text"  id=39 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=40 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=41 value="0" size="10" style="text-align: center;border: none;"></td>
						<td style="border-left:solid 5px;"><input type="text"  id=42 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=43 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=44 value="0" size="10" style="text-align: center;border: none;"></td>
					</tr>				
					<tr height ="75" align="center">
						<td style="border-bottom:solid 5px;"><input type="text"  id=45 value="0" size="10" style="text-align: center;border: none;"></td>
						<td style="border-bottom:solid 5px;"><input type="text"  id=46 value="0" size="10" style="text-align: center;border: none;"></td>
						<td style="border-bottom:solid 5px;"><input type="text"  id=47 value="0" size="10" style="text-align: center;border: none;"></td>
						<td style="border-bottom:solid 5px;border-left:solid 5px;"><input type="text"  id=48 value="0" size="10" style="text-align: center;border: none;"></td>
						<td style="border-bottom:solid 5px;"><input type="text"  id=49 value="0" size="10" style="text-align: center;border: none;"></td>
						<td style="border-bottom:solid 5px;"><input type="text"  id=50 value="0" size="10" style="text-align: center;border: none;"></td>
						<td style="border-bottom:solid 5px;border-left:solid 5px;"><input type="text"  id=51 value="0" size="10" style="text-align: center;border: none;"></td>
						<td style="border-bottom:solid 5px;"><input type="text"  id=52 value="0" size="10" style="text-align: center;border: none;"></td>
						<td style="border-bottom:solid 5px;"><input type="text"  id=53 value="0" size="10" style="text-align: center;border: none;"></td>
					</tr>				
					<tr height ="75" align="center">
						<td><input type="text"  id=54 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=55 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=56 value="0" size="10" style="text-align: center;border: none;"></td>
						<td style="border-left:solid 5px;"><input type="text"  id=57 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=58 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=59 value="0" size="10" style="text-align: center;border: none;"></td>
						<td style="border-left:solid 5px;"><input type="text"  id=60 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=61 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=62 value="0" size="10" style="text-align: center;border: none;"></td>
					</tr>				
					<tr height ="75" align="center">
						<td><input type="text"  id=63 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=64 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=65 value="0" size="10" style="text-align: center;border: none;"></td>
						<td style="border-left:solid 5px;"><input type="text"  id=66 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=67 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=68 value="0" size="10" style="text-align: center;border: none;"></td>
						<td style="border-left:solid 5px;"><input type="text"  id=69 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=70 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=71 value="0" size="10" style="text-align: center;border: none;"></td>
					</tr>				
					<tr height ="75" align="center">
						<td><input type="text"  id=72 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=73 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=74 value="0" size="10" style="text-align: center;border: none;"></td>
						<td style="border-left:solid 5px;"><input type="text"  id=75 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=76 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=77 value="0" size="10" style="text-align: center;border: none;"></td>
						<td style="border-left:solid 5px;"><input type="text"  id=78 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=79 value="0" size="10" style="text-align: center;border: none;"></td>
						<td><input type="text"  id=80 value="0" size="10" style="text-align: center;border: none;"></td>
					</tr height ="75" align="center">
				
				</form>
				</table>
			</beautiful>
			</td>
		</tr>
		<tr><td align="center">
			<br><br>Hit ENTER to solve.
		</td></tr>
	</table>


<script type="text/javascript" src="ALfunctions.js"></script>
<script type="text/javascript" src="../opacityController.js"></script>
<script>

var body  = document.getElementById('Body');
var table  = document.getElementById('Table');
var puzzle = document.getElementById('Puzzle');

showObject(body, table);

var lala, save, gogo, autonomous, dummy;
lala = new Array(9*9);
save = new Array(9*9);
gogo = new Array(9*9);


function main(code){
	switch(code){
		case 0 :
			auto();
			break;
		case 13:
			auto();
			break;
		case 46:
			aStep();
			break;
		case 44:
			quickAuto();
			break;
		case 47:
			getValues();
			if(checkAns())
				alert("right");
			else
				alert("wrong");
			break;
		default:
	}
}
function aStep(){
	getValues();
	calculate();
	updateTable();
}
function quickAuto(){
	var i;
	autonomous = true;
	while(autonomous){
		aStep();
		autonomous = false;
		for(i=0; i<81; i++){
			if(gogo[i] != lala[i]){
				autonomous = true;
				break;
			}
		}
		for(i=0; i<81; i++){	
			gogo[i] = lala[i];
		}
	}
}
function auto(){
	var i;
	autonomous = true;
	aStep();
	autonomous = false;
	for(i=0; i<81; i++){	
		if(gogo[i] != lala[i]){
			setTimeout("auto()", 500);
			autonomous = true;
			break;
		}
	}
	for(i=0; i<81; i++){	
		gogo[i] = lala[i];
	}
	if(!autonomous){
		if(checkAns()){
			alert("Complete");
		}else{
			alert("Run Dummy");
			saveNumbers();
			if(runDummy()){
				alert("Dummy success");
				return;
			}else{
				alert("Dummy fail");
				loadNumbers();
				return;
			}
		}
	}
}
function findLeastTry(){
	var k, i;
	for(k=2; k<10; k++){
		for(i=0; i<81; i++){
			if(lala[i].length==k){
				return k;
			}
		}
	}
	return false;
}
function findLeastPosition(){
	var k, i;
	for(k=2; k<10; k++){
		found = false;
		for(i=0; i<81; i++){
			if(lala[i].length==k){
				return i;
			}
		}
	}
	return false;
}
function findComplete(){
	var i;
	for(i=0; i<81; i++){
		if(lala[i].length!=1) return false;
	}
	return true;
}
function runDummy(){
	var neverGiveUp, dummyDepth, dada ,tryNum, Posit, tryOn,i;
	dada = new Array();
	posit = new Array();
	tryOn = new Array();
	tryNum = new Array();
	neverGiveUp = true;
	dummyDepth = 0;
	for(i=0; i<81; i++){
		dada[i] = lala[i];
	}
	tryOn[dummyDepth]=0;
	
	while(neverGiveUp){
		for(i=0; i<81; i++){
			lala[i] = dada[i+81*dummyDepth];
		}
		tryNum[dummyDepth]=findLeastTry();
		posit[dummyDepth]=findLeastPosition();
		lala[posit[dummyDepth]] = lala[posit[dummyDepth]].charAt(tryOn[dummyDepth]);
		updateTable();
		quickAuto();
		if(findComplete()&&checkAns()){
			return true;
		}
		if(!findComplete()){
			dummyDepth++;
			tryOn[dummyDepth]=0;
			for(i=0; i<81; i++){
				dada[i+81*dummyDepth] = lala[i];
			}
		}else{
			tryOn[dummyDepth]++;
			while(tryNum[dummyDepth]==(tryOn[dummyDepth])){
				dummyDepth--;
				tryOn[dummyDepth]++;
			}
		}
	}
	
}	
function calculate(){
	EliminateLines();
	EliminateShadowLines();
	FindOnlyOne();			
}
function getValues(){
	for(i=0; i<81; i++){	
		lala[i] = document.getElementById(i).value;
		if(lala[i]=="0") lala[i] = "123456789";
	}
}
function EliminateLines(){
	var key, leveli, levelj, rei;
	for(i=0; i<9; i++){
		for(j=0; j<9; j++){
			key = lala[i*9+j];
			if(key.length!=1) continue;
			for(k=0; k<9; k++) lala[i*9+k] = takeKeyOff(lala[i*9+k],key);
			for(k=0; k<9; k++) lala[k*9+j] = takeKeyOff(lala[k*9+j],key);
			leveli = Math.floor(i/3);
			levelj = Math.floor(j/3);
			leveli *= 3;
			levelj *= 3;
			for(ii=0; ii<3; ii++){
				for(jj=0; jj<3; jj++){
					rei = (ii+leveli)*9+levelj+jj;
					lala[rei] = takeKeyOff(lala[rei], key);
				}
			}
		}
	}
}
function EliminateShadowLines(){
	var ci, cj, leveli, levelj, number, online;
	
	for(leveli=0; leveli<9; leveli+=3){
		for(levelj=0; levelj<9; levelj+=3){
		
			for(k=1; k<=9; k++){
		
				number=0;
				ci = new Array();
				cj = new Array();
				
				for(i=0; i<3; i++){
					for(j=0; j<3; j++){
						if(lala[9*(leveli+i)+(levelj+j)].indexOf(String(k))!=-1){
							ci[number] = leveli+i;
							cj[number] = levelj+j;
							number++;
						}
					}
				}
				if(number==0){
					if(autonomous){
						return;
					}
					alert("ERROR");
				}
				if(number==1) continue;
				number -= 1;
				online = true;
				for(i=0; i<number; i++){
					if(ci[i]!=ci[i+1]){
						online = false;
						break;
					}
				}
				if(online){
					for(j=0; j<9; j++){
						if(lala[ci[0]*9+j].length==1) continue;
						if(j == levelj || j == levelj+1 || j == levelj+2) continue;
						lala[ci[0]*9+j] = takeKeyOff(lala[ci[0]*9+j],String(k));
					}
					continue;
				}
				online = true;
				for(i=0; i<number; i++){
					if(cj[i]!=cj[i+1]){
						online = false;
						break;
					}
				}
				if(online){
					for(i=0; i<9; i++){
						if(lala[i*9+cj[0]].length==1) continue;
						if(i == leveli || i == leveli+1 || i == leveli+2) continue;
						lala[i*9+cj[0]] = takeKeyOff(lala[i*9+cj[0]],String(k));
					}
				}
			}
		}
	}
}
function FindOnlyOne(){
	var ci, cj, leveli, levelj, i, j;
	for(k=1; k<=9; k++){
	
		for(leveli=0; leveli<9; leveli+=3){
			for(levelj=0; levelj<9; levelj+=3){
			
				ci=-1;
				cj=-1;
				for(i=0; i<3; i++){
					for(j=0; j<3; j++){
						if(lala[9*(leveli+i)+(levelj+j)].indexOf(String(k))!=-1){
							if(ci!=-1){
								ci=-2;
								cj=-2;
							}
							if(ci==-1){
								ci=i;
								cj=j;
							}
						}
					}
				}
				if(ci>=0) lala[9*(leveli+ci)+(levelj+cj)] = String(k);
			}
		}
		for(i=0; i<9; i++){
			cj = -1;
			for(j=0; j<9; j++){
				if(lala[i*9+j].indexOf(String(k))!=-1){	
					if(cj!=-1){
						cj=-2;
					}
					if(cj==-1){
						cj = j;
					}
				}
			}
			if(cj>=0){
				lala[i*9+cj] = String(k);
			}
		}
		for(j=0; j<9; j++){
			ci = -1;
			for(i=0; i<9; i++){
				if(lala[i*9+j].indexOf(String(k))!=-1){	
					if(ci!=-1){
						ci=-2;
					}
					if(ci==-1){
						ci = i;
					}
				}
			}
			if(ci>=0){
				lala[ci*9+j] = String(k);
			}
		}
	}
}
function updateTable(){
	for(i=0; i<81; i++){
		if(lala[i] == undefined){
			lala[i] = "0";
		}
		document.getElementById(i).value = lala[i];
		if(lala[i].length==1&&lala[i]!="0"){
			document.getElementById(i).style.width = 55 + "px";
			document.getElementById(i).style.height = 55 + "px";
			document.getElementById(i).style.fontSize = 55 + "px";
			document.getElementById(i).style.backgroundColor="skyblue";
		}else{
			document.getElementById(i).style.width = 70 + "px";
			document.getElementById(i).style.height = 70 + "px";
			document.getElementById(i).style.fontSize = 13 + "px";
			document.getElementById(i).style.backgroundColor="white";
		}
			
	}
	
}
function takeKeyOff(original, key){
	var position, sub1, sub2, leng;
	leng = original.length;
	if(leng==1) return original;
	position = original.indexOf(key);
	if(position==-1) return original;
	if(position==0)			return original.substring(1);
	if(position+1==leng)	return original.substring(0,position);
	sub1 = original.substring(0,position);
	sub2 = original.substring(position+1);
	original = sub1+sub2;
	return original;
}
function saveNumbers(){
	getValues();
	for(i=0; i<81; i++){	
		save[i] = lala[i];
	}
}
function loadNumbers(){
	for(i=0; i<81; i++){	
		lala[i] = save[i];
	}
	updateTable();
}
function checkAns(){
	var i, j, k, found, leveli, levelj;
	
	for(k=1; k<=9; k++){
	
		for(i=0; i<9; i++){
			found = false;
			for(j=0; j<9; j++){
				if(lala[i*9+j]==String(k)){
					found = true;
					break;
				}
			}
			if(!found){
				return false;
			}
		}
		for(j=0; j<9; j++){
			found = false;
			for(i=0; i<9; i++){
				if(lala[i*9+j]==String(k)){
					found = true;
					break;
				}
			}
			if(!found){
				return false;
			}
		}
		for(leveli=0; leveli<9; leveli+=3){
			for(levelj=0; levelj<9; levelj+=3){
				found = false;
				for(i=0; i<3; i++){
					for(j=0; j<3; j++){
					
						if(lala[9*(leveli+i)+(levelj+j)]==(String(k))){
							found = true;
						}
						
					}
				}
				if(!found){
					return false;
				}
			}
		}
	}
	return true;
}

</script>

</body>

</html>
