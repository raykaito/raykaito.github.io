<!DOCTYPE HTML>

<html>

<head>
	<title>Fourier Polynomial</title>
	<link rel="stylesheet" type="text/css">
	<link rel="icon" type="image/png" href="../icon.png">
	<meta name="viewport" content="width=device-width, initial-scale=1"/>
</head>


<body id="Body" bgcolor = 'black'>

	<table id="Table" border="0" align="center">
		<tr>
			<td align="left">
				<canvas id="Canvas"></canvas>
			</td>
		</tr>
		<tr>
			<td align="center" class="untouchable">
		        <input class="slider" type="range" min="1" max="50" value="1" id="slider" oninput="sliderUpdated()" onchange="sliderChanged()" style="display:none;margin:0">
			</td>
		</tr>
	</table>

	<script type="text/javascript" src="canvas.js"></script>
	<script type="text/javascript" src="../00_JavaScripts/TrigScript.js"></script>
	<script type="text/javascript">
	<!--
		//Setup Elements
		const body = document.getElementById("Body");
		const canvas = new Canvas(document.getElementById('Canvas'));
		const slider = document.getElementById('slider');

		//Setup Canvas
		canvas.flexResize();
		const width  = canvas.canvas.width;
		const height = canvas.canvas.height;
		canvas.fillAll("white");
		slider.style.width = canvas.canvas.style.width;
		console.log(canvas.canvas.style.width);

		//Setup Variables
		let xRecorded;
		let yRecorded;
		let readyForRecord = false;
		let animation;
		startRecording();

		//Record Figure
		function startRecording(){
			xRecorded = new Array();
			yRecorded = new Array();
			readyForRecord = true;
			alert("Draw something on this canvas.");
		}
		function drawRecording(){
			const currentIndex = xRecorded.length-1;
			const xi = xRecorded[currentIndex-1];
			const yi = yRecorded[currentIndex-1];
			const xf = xRecorded[currentIndex];
			const yf = yRecorded[currentIndex];
			canvas.lineWidth(1);
			canvas.strokeColor("black");
			canvas.lines(xRecorded,yRecorded);
		}

		//Animate the shrunk version
		let totalFrames, frameCount;
		function getReadyToAnimateShrink(){
			totalFrames = 30;
			frameCount = 0;
			animateShrink();
		}
		function drawShrunkDrawing(shrinkRate){
				canvas.fillAll("white");
				canvas.lineWidth(1);
				canvas.drawRect(0,0,width*shrinkRate,height*shrinkRate,"green");
				canvas.strokeColor("black");
				canvas.lines(xRecorded,yRecorded,shrinkRate);
		}
		function animateShrink(){
			if(frameCount<=totalFrames){
				requestAnimationFrame(animateShrink);
				drawShrunkDrawing(0.5+(totalFrames-frameCount)/totalFrames*0.5);
				frameCount++;
			}else{
				setTimeout(()=>{getReadyToAnimateWaves()},250);
				return;
			}
		}

		//Animate the waves in X and Y
		function getReadyToAnimateWaves(){
			totalFrames = xRecorded.length;
			frameCount = 0;
			drawReflection(frameCount);
			setTimeout(()=>{animateWaves();},750);
		}
		function drawGraph(list,imaginary=false,color="red",indexMax){
			const lineX = new Array();
			const lineY = new Array();
			if(indexMax==undefined)
				indexMax = list.length;
			for(let i=0;i<indexMax;i++){
				if(imaginary){
					lineX[i] = list[i]/2;
					lineY[i] = width/2*(1.1+i/list.length*0.8);
				}else{
					lineX[i] = height/2*(1.1+i/list.length*0.8);
					lineY[i] = list[i]/2;
				}
			}
			canvas.strokeColor(color);
			canvas.lines(lineY,lineX);
			if(imaginary){
				canvas.text("Imaginary Component",width/2,0,"black",height/30+"px 'Times'");
			}else{
				canvas.text("Real Component",0,height/2,"black",height/30+"px 'Times'");
			}
		}
		function drawReflection(index){
			const xTop = xRecorded[index]/2;
			const yTop = yRecorded[index]/2;
			const xBot = width*0.5*(1.1+index/totalFrames*0.8);
			const yBot = height*0.5*(1.1+index/totalFrames*0.8);
			canvas.circle(xTop,yTop,5,"red");
			canvas.strokeColor("lightblue");
			canvas.line(xTop,yTop,xBot,yTop);
			canvas.strokeColor("pink");
			canvas.line(xTop,yTop,xTop,yBot);
		}
		function animateWaves(){
			if(frameCount<totalFrames){
				requestAnimationFrame(animateWaves);
				frameCount++;
				drawShrunkDrawing(0.5);
				drawReflection(frameCount);
				drawGraph(xRecorded,false,"red" ,frameCount);
				drawGraph(yRecorded,true ,"blue",frameCount);
			}else{
				setTimeout(()=>{getReadyToFourierTransform()},500);
				return;
			}
		}

		//Get fourier polynomial
		let xList, yList;
		function getReadyToFourierTransform(){
			drawShrunkDrawing(0.5);
			drawGraph(xRecorded,false,"red");
			drawGraph(yRecorded,true ,"blue");
			slider.style.display = "inline-block";
			slider.max = Math.ceil(xRecorded.length/2);
			xList = new Array(xRecorded.length);
			yList = new Array(yRecorded.length);
			for(let i=0;i<xRecorded.length;i++){
				xList[i] = xRecorded[i];
				yList[i] = yRecorded[i];
			}
			setTimeout(()=>{
				alert("Use the slider to select a number of terms for this fourier polynomial.");
				sliderUpdated();
			},250);
		}
		let fourierCoefXY,fourierPolyX,fourierPolyY;
		function sliderUpdated(){
        	clearTimeout(animation);
			drawShrunkDrawing(0.5);
			drawGraph(xRecorded,false,"red");
			drawGraph(yRecorded,true ,"blue");
			fourierCoefXY = getFourierCoefficients(Number(slider.value),xList,yList);
			[fourierPolyX,fourierPolyY] = getFourierPolynomials(fourierCoefXY);
			drawGraph(fourierPolyX,false,"pink");
			drawGraph(fourierPolyY,true,"lightblue");
			canvas.strokeColor("purple");
			canvas.lines(fourierPolyX,fourierPolyY,0.5);
			canvas.text("Number of Terms: "+slider.value,0,0,"black",height/30+"px 'Times'");
			canvas.text("Number of Terms: "+slider.value,0,0,"black",height/30+"px 'Times'");
			drawFourierArm(0);

		}
		function sliderChanged(){
			getReadyToAnimateFourierDrawing();
		}
		function getReadyToAnimateFourierDrawing(){
			totalFrames = fourierPolyX.length;
			frameCount = 0;
			drawShrunkDrawing(0.5);
			drawFourierArm(0);
			totalFrames *= Math.floor(Math.sqrt(slider.value));
			setTimeout(()=>{animateFourierDrawing();},750);
		}
		function drawFourierArm(t,shrinkRate=0.5){
			const armsXY = getFourierPolynomial(fourierCoefXY,t);

			canvas.strokeColor("purple");
			canvas.lineWidth(1);
			canvas.lines(armsXY[1],armsXY[0],shrinkRate,0,0);
			

			canvas.lines(fourierPolyX,fourierPolyY,shrinkRate);
		}
		function animateFourierDrawing(){
			animation = setTimeout(animateFourierDrawing,30);
			drawShrunkDrawing(1);
			drawFourierArm(frameCount/totalFrames,1);
			frameCount = (frameCount+1)%totalFrames;
		}
		function donothing(){
			//nothing
		}
		//Calculate Fourier Polynomial
		/*
		exp(ix) = cos(x)+isin(x)
		Xn = 1/T*Int(0→T){(x*exp(-in2πt/T) dt)}
		*/
		function getFourierCoefficients(num,list,ilist){
			const T = list.length;
			const omega = 2*Math.PI/T;
			const fourierCoefficients = new Array(num);
			for(let n=-fourierCoefficients.length+1;n<fourierCoefficients.length;n++){
				fourierCoefficients[n] = new Array(2);
				let integral = 0;
				let integrali= 0;
				for(let t=0;t<list.length;t++){
					integral +=( list[t])*Math.cos(-1*n*t*omega);
					integrali+=( list[t])*Math.sin(-1*n*t*omega);
					integrali+=(ilist[t])*Math.cos(-1*n*t*omega);
					integral -=(ilist[t])*Math.sin(-1*n*t*omega);
				}
				fourierCoefficients[n][0] = integral/T;
				fourierCoefficients[n][1] = integrali/T;
			}
			return fourierCoefficients;
		}
		function getFourierPolynomials(fourierCoefficients){
			const T = xList.length;
			const omega = 2*Math.PI/T;
			const fourierPoly = new Array(T);
			const fourierPolyi= new Array(T);
			for(let t=0;t<T;t++){
				let integral = 0;
				let integrali= 0;
				for(let n=-fourierCoefficients.length+1;n<fourierCoefficients.length;n++){
					integral +=fourierCoefficients[n][0]*Math.cos(n*t*omega);
					integrali+=fourierCoefficients[n][0]*Math.sin(n*t*omega);
					integrali+=fourierCoefficients[n][1]*Math.cos(n*t*omega);
					integral -=fourierCoefficients[n][1]*Math.sin(n*t*omega);
				}
				fourierPoly [t] = integral;
				fourierPolyi[t] = integrali;
			}
			return [fourierPoly,fourierPolyi];
		}
		function getFourierPolynomial(fourierCoefficients,t){
			const omega = 2*Math.PI;
			const fourierPoly = new Array();
			const fourierPolyi= new Array();
			let arrowCount = 0;
			fourierPoly [arrowCount] = fourierCoefficients[0][0];
			fourierPolyi[arrowCount] = fourierCoefficients[0][1];
			for(let n=1;n<fourierCoefficients.length;n++){
				arrowCount++;
				fourierPoly [arrowCount] = fourierPoly [arrowCount-1];
				fourierPolyi[arrowCount] = fourierPolyi[arrowCount-1];
				fourierPoly [arrowCount] +=fourierCoefficients[ n][0]*Math.cos( n*t*omega);
				fourierPolyi[arrowCount] +=fourierCoefficients[ n][0]*Math.sin( n*t*omega);
				fourierPolyi[arrowCount] +=fourierCoefficients[ n][1]*Math.cos( n*t*omega);
				fourierPoly [arrowCount] -=fourierCoefficients[ n][1]*Math.sin( n*t*omega);

				arrowCount++;
				fourierPoly [arrowCount] = fourierPoly [arrowCount-1];
				fourierPolyi[arrowCount] = fourierPolyi[arrowCount-1];
				fourierPoly [arrowCount] +=fourierCoefficients[-n][0]*Math.cos(-n*t*omega);
				fourierPolyi[arrowCount] +=fourierCoefficients[-n][0]*Math.sin(-n*t*omega);
				fourierPolyi[arrowCount] +=fourierCoefficients[-n][1]*Math.cos(-n*t*omega);
				fourierPoly [arrowCount] -=fourierCoefficients[-n][1]*Math.sin(-n*t*omega);
			}
			//console.log(fourierPolyi);
			return [fourierPolyi,fourierPoly];
		}
	 
	//--> 
	</script>

</body>


</html>
